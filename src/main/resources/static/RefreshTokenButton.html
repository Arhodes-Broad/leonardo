<!DOCTYPE html>
<html>
    <head>
        <script src="https://apis.google.com/js/platform.js?onload=renderButton" async defer></script>

        <meta name="google-signin-client_id" content="806222273987-jdbngimv3abggnpggkroac2p6r98d8h6.apps.googleusercontent.com">
    </head>
    <body>
        <div id="my-signin2" style="top:50%; left:50%; display:block; position:absolute; margin-top:-250px; margin-left:-125px;"></div>
        <script type="text/javascript">
            function onSuccess(googleUser) {
                var expires_in = googleUser.getAuthResponse().expires_in;
                var access_token = googleUser.getAuthResponse().access_token;
                console.log('Logged in as: ' + googleUser.getBasicProfile().getName());
                setCookie(access_token, expires_in);
            }
            function setCookie(access_token, expires_in) {
                var expiresDate = new Date();
                expiresDate.setSeconds(expiresDate.getSeconds() + expires_in);
                var cookiePrefix = "LeoToken=";
                var leoCookie = cookiePrefix + access_token + ";expires=" + expiresDate.toUTCString() + ";secure;path=/;";
                document.cookie = leoCookie;
                checkCookie(cookiePrefix);
                location.reload();
            }
            async function checkCookie(cookieName) {
                var cookieIsFound = findCookie(cookieName);
                if (cookieIsFound == false) {
                    console.log('No cookie found, unauthorized to access.');
                    await sleep(10000);
                    checkCookie(cookieName);
                }
            }
            function sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
            function findCookie(cookieName) {
                var decodedCookie = decodeURIComponent(document.cookie);
                var cookieList = decodedCookie.split(';');
                for(var i = 0; i < cookieList.length; i++) {
                    var c = cookieList[i];
                    while (c.charAt(0) === ' ') {
                        c = c.substring(1);
                    }
                    if (c.indexOf(cookieName) === 0) {
                        return c.substring(cookieName.length, c.length);
                    }
                }
                return false;
            }
            function onFailure(error) {
                console.log(error);
            }
            function renderButton() {
                gapi.signin2.render('my-signin2', {
                    'scope': 'openid profile email',
                    'width': 250,
                    'height': 50,
                    'longtitle': "Sign in with Google",
                    'theme': 'dark',
                    'onsuccess': onSuccess,
                    'onfailure': onFailure
                });
            }
        </script>
    </body>
</html>